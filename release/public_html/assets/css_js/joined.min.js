function init(){var fileList=["narrator_box","style_box","script_box","about_box"];var firstFile="narrator_box";lang=document.getElementsByTagName("html")[0].lang.toUpperCase();var validLangs=new Array("PT","EN");if(validLangs.indexOf(lang)==-1){lang="EN";}tagStyle=document.body.getElementsByTagName("style")[0];tagDivs=new Array;divWorkArea=document.getElementById("work_area");filesContent=new Object;textboxCount=0;setDefaultSpeeds();forcedSpeed=null;buildingStyle=false;buildingScript=false;strStyle=new String;strScript=new String;writeByLine=false;reByLine=new RegExp("byline","i");reTagContent=new RegExp("<[\\w\\/\\s=\\'\\\"]*>","gi");reLowerThan=new RegExp("&lt;","gi");reGreaterThan=new RegExp("&gt;","gi");reEncodedHtml=new RegExp("(&lt;|&gt;)","i");tagOpen=new Array;strNewLine="\\r\\n";reNewLine=new RegExp("["+strNewLine+"]","i");strShortPause="^(,)";strMediumPause="^(\\.|!)";strLongPause="^(["+strNewLine+"]{2})";globalWriteByLine=false;globalSpeed=null;timeoutId=null;isPaused=false;curFile=new String;cssTransitionDur=null;while(fileList.length>0){var fileName=fileList.shift();Object.defineProperty(filesContent,fileName,{value:{"used":false,"expanded":true,"text":""},writable:true});};buildFileContent(firstFile);}function buildFileContent(fileName){try{if(window.XMLHttpRequest){httpRequest=new XMLHttpRequest();}else{httpRequest=new ActiveXObject("Microsoft.XMLHTTP");}httpRequest.onreadystatechange=function(){if(httpRequest.readyState==4&&httpRequest.status==200){var fileText=httpRequest.responseText;if(fileText!=""){if(document.getElementById(fileName)==null){createElem(fileName);}fileText=addStyleTags(fileText.replace(/(\n|\r\n)/g,"\r"));fileText=addScriptTags(fileText);writeToScreen(fileName,fileText);}}}}catch(e){return(false);}httpRequest.open("GET","/ajax/read_file.php?fn="+fileName+"&lang="+lang,true);httpRequest.send();}function writeToScreen(fileName,text){curFile=fileName;if(text==""){text=filesContent[fileName]["text"];}else{filesContent[fileName]["text"]=text;filesContent[fileName]["used"]=true;}var speed=speeds.default;var numCharsRemove=1;var gotoName="";var strToWrite=new String;var tagOpenLength=(tagOpen.length>0 ? tagOpen.reduce(function(n1,n2){return(n1+n2)}):0);var activateStyle=false;var activateScript=false;var curStr=text.substr(0,1);while(curStr.match(/\</i)!=null){var tagContent=text.substr(numCharsRemove-1,text.indexOf(">",numCharsRemove-1)-numCharsRemove+2);var goToCharAfterTag=true;if(tagContent.match(/\<\/?(script|style)[\s\w]*\>/i)!=null){if(tagContent.match(/\<script.*\>/i)!=null){buildingScript=true;if(tagContent.match(reByLine)!=null){writeByLine=true;}}else if(tagContent.match(/\<style.*\>/i)!=null){buildingStyle=true;if(tagContent.match(reByLine)!=null){writeByLine=true;}}else if(tagContent.match(/\<\/script\>/i)!=null){buildingScript=false;writeByLine=false;activateScript=true;}else if(tagContent.match(/\<\/style\>/i)!=null){buildingStyle=false;writeByLine=false;activateStyle=true;}}else if(tagContent.match(/\<goto \w+\>/i)!=null){var reTemp=new RegExp("\\<goto (\\w+)\\>","i");gotoName=tagContent.match(reTemp)[1];goToCharAfterTag=false;curStr="";}else if(tagContent.match(/\<\/?speed[\s\w]*\>/i)!=null){if(tagContent.match(/\<speed.*\>/i)!=null){var reTemp=new RegExp("\\<speed\\s+(\\w+)\\>","i");forcedSpeed=speeds[tagContent.match(reTemp)[1]];}else{forcedSpeed=null;}}else if(tagContent.match(/\<\/?byline\>/i)!=null){if(tagContent.match(/\<byline\>/i)!=null){writeByLine=true;}else{writeByLine=false;}}else if(!writeByLine&&!globalWriteByLine){strToWrite+=tagContent;var reTemp=new RegExp("<\\/[\\w\\/\\s=\\'\\\"]*>","i");if(tagContent.match(reTemp)!=null){tagOpen.pop();}else{reTemp=new RegExp("<(\\w+)[\\w\\/\\s=\\'\\\".:-]*>","i");tagOpen.push(tagContent.match(reTemp)[1].length+3);}}else{break;}numCharsRemove+=tagContent.length;if(goToCharAfterTag){curStr=text.substr(numCharsRemove-1,1);}if(writeByLine||globalWriteByLine){break;}}if(writeByLine||globalWriteByLine){var testStr=text.substr(numCharsRemove-1);var lbIndex=testStr.search(reNewLine);if(buildingScript){var ctIndex=testStr.search(/\<\/script\>/i);}else if(buildingStyle){var ctIndex=testStr.search(/\<\/style\>/i);}else{var ctIndex=testStr.search(/\<\/byline\>/i);}if(lbIndex==-1&&ctIndex==-1){lbIndex=text.length-1;ctIndex=text.length;}else{if(lbIndex==-1){lbIndex=text.length;}if(ctIndex==-1){ctIndex=text.length;}}if(lbIndex>=0&&lbIndex<ctIndex){if(gotoName.length>0){curStr=testStr.substr(0,lbIndex);numCharsRemove+=curStr.length;}else{curStr=testStr.substr(0,lbIndex+1);numCharsRemove+=curStr.length-1;}}else{curStr=testStr.substr(0,ctIndex);numCharsRemove+=curStr.length-1;}}else if(curStr=="&"){var strTmp=text.substr(numCharsRemove-1,text.indexOf(";",numCharsRemove-1)-numCharsRemove+2);if(strTmp.match(reEncodedHtml)!=null){curStr=strTmp;numCharsRemove+=strTmp.length-1;}}if(buildingStyle&&curStr.match(/\}\s?$/i)!=null){activateStyle=true;}strToWrite+=curStr;if(buildingStyle){strStyle+=strToWrite.replace(reTagContent,"");}else if(buildingScript){strScript+=strToWrite.replace(reTagContent,"");}if(strToWrite.length>0){if(typeof textboxExpandCollapse=="function"){textboxExpandCollapse(fileName,true);}tagDivs[fileName].lastElementChild.innerHTML=tagDivs[fileName].lastElementChild.innerHTML.substr(0,tagDivs[fileName].lastElementChild.innerHTML.length-tagOpenLength)+strToWrite;tagDivs[fileName].lastElementChild.scrollTop=tagDivs[fileName].lastElementChild.scrollHeight;}if(activateStyle){tagStyle.innerHTML+=strStyle.replace(reLowerThan,"<").replace(reGreaterThan,">");strStyle="";activateStyle=false;}else if(activateScript){var tagScript=document.createElement("script");tagScript.innerHTML=strScript.replace(reLowerThan,"<").replace(reGreaterThan,">");document.body.appendChild(tagScript);strScript="";activateScript=false;}if(gotoName.length>0||text.length-numCharsRemove>0){if(!isPaused){if(forcedSpeed===null&&globalSpeed===null){if(!buildingStyle&&!buildingScript){var testStr=curStr+text.substr(numCharsRemove,1);if(writeByLine){speed=speeds.textByLine;}else if(testStr.match(new RegExp(strShortPause,"i"))!=null){speed=speeds.shortPause;}else if(testStr.match(new RegExp(strMediumPause,"i"))!=null){speed=speeds.mediumPause;}else if(testStr.match(new RegExp(strLongPause,"i"))!=null){speed=speeds.longPause;}}else if(buildingStyle){if(writeByLine){speed=speeds.styleByLine;}else{speed=speeds.styleByChar;}}else if(buildingScript){if(writeByLine){speed=speeds.scriptByLine;}else{speed=speeds.scriptByChar;}}}else{if(globalSpeed===null){speed=forcedSpeed;}else{speed=globalSpeed;}}filesContent[fileName]["text"]=filesContent[fileName]["text"].slice(numCharsRemove);timeoutId=window.setTimeout(function(){if(gotoName.length==0){writeToScreen(fileName,"");}else if(filesContent[gotoName]["used"]==false){buildFileContent(gotoName);}else{writeToScreen(gotoName,"");}},speed);}}else{document.getElementById("footer_controls").className+=" no_events opacity_zero";blockMouseEvents(false);}}function createElem(elemId){var newDiv=document.createElement("div");newDiv.id=elemId;newDiv.className="content flex_item";newDiv.style.order=textboxCount++;var newDivText=document.createElement("div");newDivText.className="text text_expanded";newDiv.appendChild(newDivText);divWorkArea.appendChild(newDiv);tagDivs[elemId]=document.getElementById(elemId);if(typeof addHeaders=="function"){addHeaders(elemId);}}function addStyleTags(text){var tagStart=0;var tagEnd=0;var strFinal=new String;var strTemp=new String;var reKeyWord=new RegExp("(@[\\w\\t ]+)\\(","gi");var reSelector=new RegExp("([\\w\\*\\.\\#\\t: ]+)(\\s?[\\{,])","gi");var reProperty=new RegExp("([\\{;\\(]\\s*)([\\w-]+)(\\s*:)","gi");var reValue=new RegExp(":([^:;]*)([;)])","gi");var reValueUnits=new RegExp("(\\d)(px|%|rem|em|vh|vw|s|ms)","gi");while(true){tagStart=text.search(/\<style.*\>/i);if(tagStart==-1){if(text.length>0){strFinal+=text.substr(0);}break;}tagStart+=text.substr(tagStart,text.indexOf(">",tagStart)-tagStart).length+1;strFinal+=text.substr(0,tagStart);tagEnd=text.indexOf("</style>",tagStart);if(tagEnd==-1){tagEnd=text.length;}strTemp=text.substr(tagStart,tagEnd-tagStart);strTemp=strTemp.replace(reKeyWord,"<span class='css_keyword'>$1</span>(");strTemp=strTemp.replace(reSelector,"<span class='css_selector'>$1</span>$2");strTemp=strTemp.replace(/\{([^{}]+)<span class='css_selector'>([^{}]+)<\/span>([^{}]+)\}/ig,function(string){return(string.replace(/<span class='css_selector'\s*>([^\/]+)<\/span>/ig,"$1"));});strTemp=strTemp.replace(reProperty,"$1<span class='css_property'>$2</span>$3");strTemp=strTemp.replace(reValue,":<span class='css_value'>$1</span>$2");strTemp=strTemp.replace(reValueUnits,"$1<span class='css_units'>$2</span>");strFinal+=strTemp+"</style>";text=text.slice(tagEnd+8);}return(strFinal);}function addScriptTags(text){var tagStart=0;var tagEnd=0;var strFinal=new String;var strTemp=new String;var reFunctionDeclaration=new RegExp("(function[\\t ]+)(\\w+[\\t ]*)\\((.*)\\)([\\t ]*{)","gi");var reKeyWord=new RegExp("([\\w])?(new|while|for|break|continue|try|catch|return|if|else|typeof)([^\\w])","gi");var reMathOperator=new RegExp("([^<])(\\++|\\-+|\\*|\\/)","gi");var reLogicOperator=new RegExp("(&&|\\|\\||!=|={1,3}|&lt;|&gt;)","gi");var reObject=new RegExp("(Object|var|document)","gi");var reValue=new RegExp("(\\d|true|false|null)","gi");var reMethod=new RegExp("\\.(\\w+)","gi");var reString=new RegExp("(\\\"[^\\\"]*\\\")","i");var reRegExp=new RegExp("([^<>])(\\/[^/]+\\/[gmi]*)","i");while(true){tagStart=text.search(/\<script.*\>/i);if(tagStart==-1){if(text.length>0){strFinal+=text.substr(0);}break;}tagStart+=text.substr(tagStart,text.indexOf(">",tagStart)-tagStart).length+1;strFinal+=text.substr(0,tagStart);tagEnd=text.indexOf("</script>",tagStart);if(tagEnd==-1){tagEnd=text.length;}strTemp=text.substr(tagStart,tagEnd-tagStart);strTemp=strTemp.replace(reLogicOperator,"<span class='js_logicoperator'>$1</span>");strTemp=strTemp.replace(reMathOperator,"$1<span class='js_mathoperator'>$2</span>");strTemp=strTemp.replace(reFunctionDeclaration,"<span class='js_func_word'>$1</span><span class='js_func_name'>$2</span>(<span class='js_func_param'>$3</span>)$4");strTemp=strTemp.replace(reKeyWord,"$1<span class='js_keyword'>$2</span>$3");strTemp=strTemp.replace(reObject,"<span class='js_object'>$1</span>");strTemp=strTemp.replace(reValue,"<span class='js_value'>$1</span>");strTemp=strTemp.replace(reMethod,".<span class='js_method'>$1</span>");strTemp=strTemp.replace(/<span class='js_mathoperator'\s*>\/<\/span>([^\/]+)<span class='js_mathoperator'\s*>\/<\/span>([gmi]*)/ig,"/$1/$2");var reMatch=strTemp.match(reRegExp);if(reMatch!=null){var strAux=new String;do{strAux+=strTemp.substr(0,reMatch.index);strAux+=strTemp.substr(reMatch.index,reMatch[0].length).replace(reRegExp,function(string){return(string.replace(/<span class='js_mathoperator'\s*>([<>]+)<\/span>/ig,"$1").replace(/<span\s+class='(css|js)_\w+'\s*>([^>]*)<\/span>/ig,"$2"));}).replace(reRegExp,"$1<span class='js_regexp'>$2</span>");strTemp=strTemp.slice(reMatch.index+reMatch[0].length);reMatch=strTemp.match(reRegExp);}while(reMatch!=null)strAux+=strTemp;strTemp=strAux;}var reMatch=strTemp.match(reString);if(reMatch!=null){var strAux=new String;do{strAux+=strTemp.substr(0,reMatch.index);strAux+=strTemp.substr(reMatch.index,reMatch[0].length).replace(reString,function(string){return(string.replace(/<span class='js_mathoperator'\s*>([<>]+)<\/span>/ig,"$1").replace(/<span\s+class='(css|js)_\w+'\s*>([^>]*)<\/span>/ig,"$2"));}).replace(reString,"<span class='js_string'>$1</span>");strTemp=strTemp.slice(reMatch.index+reMatch[0].length);reMatch=strTemp.match(reString);}while(reMatch!=null)strAux+=strTemp;strTemp=strAux;}strFinal+=strTemp+"</script>";text=text.slice(tagEnd+9);}return(strFinal);}function scrollBoxesToBottom(elemId){if(elemId==null){var elems=document.querySelectorAll("div.text");}else{var elems=[tagDivs[elemId].lastElementChild];}for(var i=0;i<elems.length;i++){elems[i].scrollTop=elems[i].scrollHeight;}}function setDefaultSpeeds(){speeds={"default":20,"styleByChar":10,"scriptByChar":10,"styleByLine":100,"scriptByLine":100,"textByLine":100,"shortPause":275,"mediumPause":550,"LongPause":750,};}function setSpeed(speedMode){if(speedMode===1){setDefaultSpeeds();globalSpeed=null;globalWriteByLine=false;}else if(speedMode===2){speeds.shortPause=0;speeds.mediumPause=0;speeds.LongPause=0;globalSpeed=null;globalWriteByLine=false;}else if(speedMode===3){globalSpeed=0;globalWriteByLine=true;}var speedButtons=document.querySelectorAll(".speed");for(var i=0;i<speedButtons.length;i++){if(i===speedMode-1){speedButtons[i].className=speedButtons[i].className.replace("clickable","selected").trim();}else{speedButtons[i].className=speedButtons[i].className.replace("selected","clickable").trim();}};}function pauseExec(){window.clearTimeout(timeoutId);isPaused=true;document.getElementById("pause_button").className+=" hidden";var tempElem=document.getElementById("resume_button");tempElem.className=tempElem.className.replace("hidden","").trim();blockMouseEvents(false);}function resumeExec(){var resumeDelay=0;blockMouseEvents(true);if(typeof textboxExpandCollapse=="function"){if(cssTransitionDur==null){getTransitionDuration();}var elems=document.querySelectorAll("div.content");for(var i=0;i<elems.length;i++){var matchCollapsed=elems[i].className.match(/content_collapsed/i);if((matchCollapsed==null&&!filesContent[elems[i].id]["expanded"])||(matchCollapsed!=null&&filesContent[elems[i].id]["expanded"])){textboxExpandCollapse(elems[i].id,false);resumeDelay=cssTransitionDur;}};}isPaused=false;window.setTimeout(function(){writeToScreen(curFile,"");},resumeDelay);document.getElementById("resume_button").className+=" hidden";var tempElem=document.getElementById("pause_button");tempElem.className=tempElem.className.replace("hidden","").trim();}function getTransitionDuration(){var re=new RegExp("\\*\\s*\\{[^\\{\\}]+transition\\s*:[^\\{\\}\\d]+([\\d\\.]+)(s|ms)[^\\{\\}]+\\}","i");if(tagStyle.innerHTML.match(re)!=null){cssTransitionDur=tagStyle.innerHTML.match(re)[1]*(tagStyle.innerHTML.match(re)[2]=="s" ? 1000:1);}else{cssTransitionDur=0;}}function blockMouseEvents(turnOn){if(turnOn){if(divWorkArea.className.match(/no_events/i)==null){divWorkArea.className+=" no_events";}}else{divWorkArea.className=divWorkArea.className.replace(/no_events/i,"").trim();}}