function init(built_on_server){var file_list=["narrator_box","style_box","script_box","about_box"];var first_file="narrator_box";lang_=document.getElementsByTagName("html")[0].lang.toUpperCase();var valid_langs=new Array("PT","EN");if(valid_langs.indexOf(lang_)==-1){lang_="EN";}tag_divs_=new Array;if(built_on_server){for(var i=0;i<file_list.length;i++){tag_divs_[file_list[i]]=document.getElementById(file_list[i]);}}tag_style_=document.body.getElementsByTagName("style")[0];div_work_area_=document.getElementById("work_area");files_content_=new Object;textbox_count_=0;setDefaultSpeeds();forced_speed_=null;building_style_=false;building_script_=false;str_style_=new String;str_script_=new String;write_by_Line_=false;re_by_line_=new RegExp("byline","i");str_tag_content_="\\w\\/\\s=\\'\\\"\\.\\:\\-";re_tag_content_=new RegExp("<["+str_tag_content_+"]+>","gi");tag_open_=new Array;var str_new_line="\\r\\n";re_new_line_=new RegExp("["+str_new_line+"]","i");str_short_pause_="^(,)";str_medium_pause_="^(\\.|!)";str_long_pause_="^(["+str_new_line+"]{2})";global_write_by_line_=false;global_speed_=null;timeout_id_=null;is_paused_=false;cur_file_=new String;css_transition_dur_=null;while(file_list.length>0){var file_name=file_list.shift();Object.defineProperty(files_content_,file_name,{value:{"used":false,"expanded":true,"text":""},writable:true});};if(built_on_server){addHeaderClickEvent();}else{buildFileContent(first_file);}}function buildFileContent(file_name){try{if(window.XMLHttpRequest){http_request=new XMLHttpRequest();}else{http_request=new ActiveXObject("Microsoft.XMLHTTP");}http_request.onreadystatechange=function(){if(http_request.readyState==4&&http_request.status==200){var file_text=http_request.responseText;if(file_text!=""){if(document.getElementById(file_name)==null){createElem(file_name);}file_text=addStyleTags(file_text.replace(/(\n|\r\n)/g,"\r"));file_text=addScriptTags(file_text);writeToScreen(file_name,file_text);}}}}catch(e){return(false);}http_request.open("GET","/ajax/read_file.php?fn="+file_name+"&lang="+lang_,true);http_request.send();}function writeToScreen(file_name,text){cur_file_=file_name;if(text==""){text=files_content_[file_name]["text"];}else{files_content_[file_name]["text"]=text;files_content_[file_name]["used"]=true;}var speed=speeds_.default;var num_chars_remove=1;var goto_name="";var str_to_write=new String;var tag_open_length=(tag_open_.length>0 ? tag_open_.reduce(function(n1,n2){return(n1+n2)}):0);var activate_style=false;var activate_script=false;var cur_str=text.substr(0,1);while(cur_str.match(/\</i)!=null){if(text.search(re_tag_content_)!=0){break;}var tag_content=text.substr(num_chars_remove-1,text.indexOf(">",num_chars_remove-1)-num_chars_remove+2);var goto_char_after_tag=true;if(tag_content.match(/\<\/?(script|style)[\s\w]*\>/i)!=null){if(tag_content.match(/\<script.*\>/i)!=null){building_script_=true;if(tag_content.match(re_by_line_)!=null){write_by_Line_=true;}}else if(tag_content.match(/\<style.*\>/i)!=null){building_style_=true;if(tag_content.match(re_by_line_)!=null){write_by_Line_=true;}}else if(tag_content.match(/\<\/script\>/i)!=null){building_script_=false;write_by_Line_=false;activate_script=true;}else if(tag_content.match(/\<\/style\>/i)!=null){building_style_=false;write_by_Line_=false;activate_style=true;}}else if(tag_content.match(/\<goto \w+\>/i)!=null){var re_temp=new RegExp("\\<goto (\\w+)\\>","i");goto_name=tag_content.match(re_temp)[1];goto_char_after_tag=false;cur_str="";}else if(tag_content.match(/\<\/?speed[\s\w]*\>/i)!=null){if(tag_content.match(/\<speed.*\>/i)!=null){var re_temp=new RegExp("\\<speed\\s+(\\w+)\\>","i");forced_speed_=speeds_[tag_content.match(re_temp)[1]];}else{forced_speed_=null;}}else if(tag_content.match(/\<\/?byline\>/i)!=null){if(tag_content.match(/\<byline\>/i)!=null){write_by_Line_=true;}else{write_by_Line_=false;}}else if(!write_by_Line_&&!global_write_by_line_){str_to_write+=tag_content;var re_temp=new RegExp("<\\/["+str_tag_content_+"]+>","i");if(tag_content.match(re_temp)!=null){tag_open_.pop();}else{re_temp=new RegExp("<(\\w+)["+str_tag_content_+"]*>","i");tag_open_.push(tag_content.match(re_temp)[1].length+3);}}else{break;}num_chars_remove+=tag_content.length;if(goto_char_after_tag){cur_str=text.substr(num_chars_remove-1,1);}if(write_by_Line_||global_write_by_line_){break;}}if(write_by_Line_||global_write_by_line_){var test_str=text.substr(num_chars_remove-1);var lb_index=test_str.search(re_new_line_);if(building_script_){var ct_index=test_str.search(/\<\/script\>/i);}else if(building_style_){var ct_index=test_str.search(/\<\/style\>/i);}else{var ct_index=test_str.search(/\<\/byline\>/i);}if(lb_index==-1&&ct_index==-1){lb_index=text.length-1;ct_index=text.length;}else{if(lb_index==-1){lb_index=text.length;}if(ct_index==-1){ct_index=text.length;}}if(lb_index>=0&&lb_index<ct_index){if(goto_name.length>0){cur_str=test_str.substr(0,lb_index);num_chars_remove+=cur_str.length;}else{cur_str=test_str.substr(0,lb_index+1);num_chars_remove+=cur_str.length-1;}}else{cur_str=test_str.substr(0,ct_index);num_chars_remove+=cur_str.length-1;}}if(building_style_&&cur_str.match(/\}\s?$/i)!=null){activate_style=true;}str_to_write+=cur_str;if(building_style_){str_style_+=str_to_write.replace(re_tag_content_,"");}else if(building_script_){str_script_+=str_to_write.replace(re_tag_content_,"");}if(str_to_write.length>0){if(typeof textboxExpandCollapse=="function"){textboxExpandCollapse(file_name,true);}tag_divs_[file_name].lastElementChild.innerHTML=tag_divs_[file_name].lastElementChild.innerHTML.substr(0,tag_divs_[file_name].lastElementChild.innerHTML.length-tag_open_length)+str_to_write;tag_divs_[file_name].lastElementChild.scrollTop=tag_divs_[file_name].lastElementChild.scrollHeight;}if(activate_style){tag_style_.innerHTML+=str_style_;str_style_="";activate_style=false;}else if(activate_script){var tag_script=document.createElement("script");tag_script.innerHTML=str_script_;document.body.appendChild(tag_script);str_script_="";activate_script=false;}if(goto_name.length>0||text.length-num_chars_remove>0){if(!is_paused_){if(forced_speed_===null&&global_speed_===null){if(!building_style_&&!building_script_){var test_str=cur_str+text.substr(num_chars_remove,1);if(write_by_Line_){speed=speeds_.text_by_line;}else if(test_str.match(new RegExp(str_short_pause_,"i"))!=null){speed=speeds_.short_pause;}else if(test_str.match(new RegExp(str_medium_pause_,"i"))!=null){speed=speeds_.medium_pause;}else if(test_str.match(new RegExp(str_long_pause_,"i"))!=null){speed=speeds_.longPause;}}else if(building_style_){if(write_by_Line_){speed=speeds_.style_by_line;}else{speed=speeds_.style_by_char;}}else if(building_script_){if(write_by_Line_){speed=speeds_.script_by_line;}else{speed=speeds_.script_by_char;}}}else{if(global_speed_===null){speed=forced_speed_;}else{speed=global_speed_;}}files_content_[file_name]["text"]=files_content_[file_name]["text"].slice(num_chars_remove);timeout_id_=window.setTimeout(function(){if(goto_name.length==0){writeToScreen(file_name,"");}else if(files_content_[goto_name]["used"]==false){buildFileContent(goto_name);}else{writeToScreen(goto_name,"");}},speed);}}else{document.getElementById("footer_controls").className+=" no_events opacity_zero";blockMouseEvents(false);}}function createElem(elem_id){var new_div=document.createElement("div");new_div.id=elem_id;new_div.className="content flex_item";new_div.style.order=textbox_count_++;var new_div_text=document.createElement("div");new_div_text.className="text text_expanded";new_div.appendChild(new_div_text);div_work_area_.appendChild(new_div);tag_divs_[elem_id]=document.getElementById(elem_id);if(typeof addHeaders=="function"){addHeaders(elem_id);}}function addStyleTags(text){var tag_start=0;var tag_end=0;var str_final=new String;var str_temp=new String;var re_key_word=new RegExp("(@[\\w\\t ]+)\\(","gi");var re_selector=new RegExp("([\\w\\*\\.\\#\\t: ]+)(\\s?[\\{,])","gi");var re_property=new RegExp("([\\{;\\(]\\s*)([\\w-]+)(\\s*:)","gi");var re_value=new RegExp(":([^:;]*)([;)])","gi");var re_value_units=new RegExp("(\\d)(px|%|rem|em|vh|vw|s|ms)","gi");while(true){tag_start=text.search(/\<style[^\<]*\>/i);if(tag_start==-1){if(text.length>0){str_final+=text.substr(0);}break;}tag_start+=text.substr(tag_start,text.indexOf(">",tag_start)-tag_start).length+1;str_final+=text.substr(0,tag_start);tag_end=text.indexOf("</style>",tag_start);if(tag_end==-1){tag_end=text.length;}str_temp=text.substr(tag_start,tag_end-tag_start);str_temp=str_temp.replace(re_key_word,"<span class='css_keyword'>$1</span>(");str_temp=str_temp.replace(re_selector,"<span class='css_selector'>$1</span>$2");str_temp=str_temp.replace(/\{([^{}]+)<span class='css_selector'>([^{}]+)<\/span>([^{}]+)\}/ig,function(string){return(string.replace(/<span class='css_selector'\s*>([^\/]+)<\/span>/ig,"$1"));});str_temp=str_temp.replace(re_property,"$1<span class='css_property'>$2</span>$3");str_temp=str_temp.replace(re_value,":<span class='css_value'>$1</span>$2");str_temp=str_temp.replace(re_value_units,"$1<span class='css_units'>$2</span>");str_final+=str_temp+"</style>";text=text.slice(tag_end+8);}return(str_final);}function addScriptTags(text){var tag_start=0;var tag_end=0;var str_final=new String;var str_temp=new String;var re_function_declaration=new RegExp("(function[\\t ]+)(\\w+[\\t ]*)\\(([^\)]*)\\)([\\t ]*{)","gi");var re_key_word=new RegExp("([\\w])?(new|while|for|break|continue|try|catch|return|if|else|typeof)([^\\w])","gi");var re_math_operator=new RegExp("([^<])(\\++|\\-+|\\*|\\/)","gi");var re_logic_operator=new RegExp("(&&|\\|\\||!=|={1,3}|<|>)","gi");var re_object=new RegExp("(Object|var|document)","gi");var re_value=new RegExp("(\\d|true|false|null)","gi");var re_method=new RegExp("\\.(\\w+)","gi");var re_string=new RegExp("(\\\"[^\\\"]*\\\")","i");var re_regexp=new RegExp("([^<>])(\\/[^/]+\\/[gmi]*)","i");while(true){tag_start=text.search(/\<script[^\<]*\>/i);if(tag_start==-1){if(text.length>0){str_final+=text.substr(0);}break;}tag_start+=text.substr(tag_start,text.indexOf(">",tag_start)-tag_start).length+1;str_final+=text.substr(0,tag_start);tag_end=text.indexOf("</script>",tag_start);if(tag_end==-1){tag_end=text.length;}str_temp=text.substr(tag_start,tag_end-tag_start);str_temp=str_temp.replace(re_logic_operator,"<span class='js_logicoperator'>$1</span>");str_temp=str_temp.replace(re_math_operator,"$1<span class='js_mathoperator'>$2</span>");str_temp=str_temp.replace(re_function_declaration,"<span class='js_func_word'>$1</span><span class='js_func_name'>$2</span>(<span class='js_func_param'>$3</span>)$4");str_temp=str_temp.replace(re_key_word,"$1<span class='js_keyword'>$2</span>$3");str_temp=str_temp.replace(re_object,"<span class='js_object'>$1</span>");str_temp=str_temp.replace(re_value,"<span class='js_value'>$1</span>");str_temp=str_temp.replace(re_method,".<span class='js_method'>$1</span>");str_temp=str_temp.replace(/<span class='js_mathoperator'\s*>\/<\/span>([^\/]+)<span class='js_mathoperator'\s*>\/<\/span>([gmi]*)/ig,"/$1/$2");var re_match=str_temp.match(re_regexp);if(re_match!=null){var str_aux=new String;do{str_aux+=str_temp.substr(0,re_match.index);str_aux+=str_temp.substr(re_match.index,re_match[0].length).replace(re_regexp,function(string){return(string.replace(/<span class='js_mathoperator'\s*>([<>]+)<\/span>/ig,"$1").replace(/<span\s+class='(css|js)_\w+'\s*>([^>]*)<\/span>/ig,"$2"));}).replace(re_regexp,"$1<span class='js_regexp'>$2</span>");str_temp=str_temp.slice(re_match.index+re_match[0].length);re_match=str_temp.match(re_regexp);}while(re_match!=null)str_aux+=str_temp;str_temp=str_aux;}var re_match=str_temp.match(re_string);if(re_match!=null){var str_aux=new String;do{str_aux+=str_temp.substr(0,re_match.index);str_aux+=str_temp.substr(re_match.index,re_match[0].length).replace(re_string,function(string){return(string.replace(/<span class='js_mathoperator'\s*>([<>]+)<\/span>/ig,"$1").replace(/<span\s+class='(css|js)_\w+'\s*>([^>]*)<\/span>/ig,"$2"));}).replace(re_string,"<span class='js_string'>$1</span>");str_temp=str_temp.slice(re_match.index+re_match[0].length);re_match=str_temp.match(re_string);}while(re_match!=null)str_aux+=str_temp;str_temp=str_aux;}str_final+=str_temp+"</script>";text=text.slice(tag_end+9);}return(str_final);}function scrollBoxesToBottom(elem_id){if(elem_id==null){var elems=document.querySelectorAll("div.text");}else{var elems=[tag_divs_[elem_id].lastElementChild];}for(var i=0;i<elems.length;i++){elems[i].scrollTop=elems[i].scrollHeight;}}function setDefaultSpeeds(){speeds_={"default":20,"style_by_char":10,"script_by_char":10,"style_by_line":100,"script_by_line":100,"text_by_line":100,"short_pause":275,"medium_pause":550,"Long_pause":750,};}function setSpeed(speed_mode){if(speed_mode===1){setDefaultSpeeds();global_speed_=null;global_write_by_line_=false;}else if(speed_mode===2){speeds_.short_pause=0;speeds_.medium_pause=0;speeds_.Long_pause=0;global_speed_=null;global_write_by_line_=false;}else if(speed_mode===3){global_speed_=0;global_write_by_line_=true;}var speed_buttons=document.querySelectorAll(".speed");for(var i=0;i<speed_buttons.length;i++){if(i===speed_mode-1){speed_buttons[i].className=speed_buttons[i].className.replace("clickable","selected").trim();}else{speed_buttons[i].className=speed_buttons[i].className.replace("selected","clickable").trim();}};}function pauseExec(){window.clearTimeout(timeout_id_);is_paused_=true;document.getElementById("pause_button").className+=" hidden";var temp_elem=document.getElementById("resume_button");temp_elem.className=temp_elem.className.replace("hidden","").trim();blockMouseEvents(false);}function resumeExec(){var resume_delay=0;blockMouseEvents(true);if(typeof textboxExpandCollapse=="function"){if(css_transition_dur_==null){getTransitionDuration();}var elems=document.querySelectorAll("div.content");for(var i=0;i<elems.length;i++){var match_collapsed=elems[i].className.match(/content_collapsed/i);if((match_collapsed==null&&!files_content_[elems[i].id]["expanded"])||(match_collapsed!=null&&files_content_[elems[i].id]["expanded"])){textboxExpandCollapse(elems[i].id,false);resume_delay=css_transition_dur_;}};}is_paused_=false;window.setTimeout(function(){writeToScreen(cur_file_,"");},resume_delay);document.getElementById("resume_button").className+=" hidden";var temp_elem=document.getElementById("pause_button");temp_elem.className=temp_elem.className.replace("hidden","").trim();}function getTransitionDuration(){var re=new RegExp("\\*\\s*\\{[^\\{\\}]+transition\\s*:[^\\{\\}\\d]+([\\d\\.]+)(s|ms)[^\\{\\}]+\\}","i");if(tag_style_.innerHTML.match(re)!=null){css_transition_dur_=tag_style_.innerHTML.match(re)[1]*(tag_style_.innerHTML.match(re)[2]=="s" ? 1000:1);}else{css_transition_dur_=0;}}function blockMouseEvents(turn_on){if(turn_on){if(div_work_area_.className.match(/no_events/i)==null){div_work_area_.className+=" no_events";}}else{div_work_area_.className=div_work_area_.className.replace(/no_events/i,"").trim();}}